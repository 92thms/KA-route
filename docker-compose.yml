services:
  klanavo:
    build:
      context: .              # <â€” Projekt-Root als Kontext
      dockerfile: ops/Dockerfile
    container_name: klanavo
    ports:
      - "8401:80"
    restart: unless-stopped
    shm_size: "1g"
    ipc: host
    environment:
      ORS_API_KEY: ${ORS_API_KEY}
      SEARCH_RADIUS_KM: ${SEARCH_RADIUS_KM:-10}
      STEP_KM: ${STEP_KM:-50}
      MAINTENANCE_MODE: ${MAINTENANCE_MODE:-0}
      MAINTENANCE_KEY: ${MAINTENANCE_KEY:-}
      USE_ORS_REVERSE: ${USE_ORS_REVERSE:-0}
    volumes:
      - cache-data:/app/api/cache
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  cache-data:
    driver: local
    driver_opts:
      type: tmpfs
      device: tmpfs
      o: size=8g
